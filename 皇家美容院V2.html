
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>楓之谷 皇家抽選模擬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="device_control.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f8;
      padding: 20px;
      text-align: center;
    }
    .container {
  max-width: 600px;
  width: 100%;
  margin: 0 auto;
  padding: 0 1em;
  box-sizing: border-box;
}
    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .button-group + .button-group {
      margin-top: 10px;
    }
    .button-group button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #e0e0ff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .button-group button.active, .button-group button:hover {
      background-color: #a89aff;
      transform: scale(1.05);
    }
    .tab-content {
      display: none;
      margin-top: 20px;
    }
    .tab-content.active {
      display: block;
    }
    .draw-button {
  font-size: 1.1em;
  padding: 12px 20px;
  background: linear-gradient(to right, #80d0c7, #13547a);
  border-radius: 12px;
  border: none;
  color: white;
  cursor: pointer;
  margin: 10px 0;
  transition: all 0.3s ease;
  box-shadow: 0 5px 10px rgba(0,0,0,0.15);
  flex: 1 1 45%; /* ✨ 核心設定：讓兩顆按鈕佔一行 */
  max-width: 220px; /* 避免太寬 */
  min-width: 120px; /* 避免太窄 */
}
    .draw-button:hover {
      background: linear-gradient(to right, #13547a, #80d0c7);
      transform: translateY(-2px);
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    .stats-box {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9ff;
      border: 1px dashed #aaa;
      border-radius: 8px;
      font-size: 0.95em;
      text-align: left;
    }
    .history-box {
  max-height: 200px;
  overflow-y: auto;
  overflow-x: hidden;
  margin-top: 10px;
  text-align: left;
  padding: 10px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  word-break: break-word;
  font-size: 0.95em;
}
    .draw-reset-wrap {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .sss-bg {
      background-color: gold;
      color: black;
      padding: 2px 5px;
      border-radius: 4px;
      font-weight: bold;
    }
    .ss-bg {
      background-color: #a64ca6;
      color: white;
      padding: 2px 5px;
      border-radius: 4px;
      font-weight: bold;
    }
    .s-bg {
      background-color: #3399ff;
      color: white;
      padding: 2px 5px;
      border-radius: 4px;
    }
    .a-bg {
      background-color: #66cc66;
      color: black;
      padding: 2px 5px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <a href="index.html" style="
  position: absolute;
  top: 15px;
  left: 15px;
  background: #eee;
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 14px;
  text-decoration: none;
  color: #333;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  z-index: 1000;
">
  🏠 回首頁
</a>
  <div class="container">
    <h1>楓之谷 皇家美容 / 整形抽選</h1>
    <div class="button-group">
      <button onclick="selectGender('male')" id="genderMale" class="active">👦 男</button>
      <button onclick="selectGender('female')" id="genderFemale">👧 女</button>
    </div>
    <div class="button-group">
  <button onclick="switchMainTab('single')" id="mainTabSingle" class="active">🎲 單抽美容美髮</button>
  <button onclick="switchMainTab('target')" id="mainTabTarget">🎯 目標抽卡</button>
</div>
   <div id="singleTab" class="tab-content active">

<div class="button-group">

<button onclick="switchTab('hair')" id="tabHair"

class="active"> 美髮</button>

<button onclick="switchTab('face')" id="tabFace">

整形</button>

</div>
    <div id="hairTab" class="tab-content active">
      <div class="draw-reset-wrap">
        <button class="draw-button" onclick="draw('hair')">抽選髮型</button>
        <button class="draw-button" onclick="clearData('hair')">清除資料</button>
      </div>
      <div class="result-box" id="hairResult">請點選上方按鈕抽選</div>
      <div class="stats-box">
        抽卡數：<span id="hairCount">0</span>金額：<span id="hairCost">0</span> 元<br>
        主1：<span id="hairMain1">0</span> (<span id="hairPct1">0.00%</span>)<br>
        主2：<span id="hairMain2">0</span> (<span id="hairPct2">0.00%</span>)<br>
        主3：<span id="hairMain3">0</span> (<span id="hairPct3">0.00%</span>)<br>
        主4：<span id="hairMain4">0</span> (<span id="hairPct4">0.00%</span>)
      </div>
      <div class="history-box" id="hairHistoryMale" style="display: block;"></div>
<div class="history-box" id="hairHistoryFemale" style="display: none;">
  
</div>

    </div>
    <div id="faceTab" class="tab-content">
      <div class="draw-reset-wrap">
        <button class="draw-button" onclick="draw('face')">抽選臉型</button>
        <button class="draw-button" onclick="clearData('face')">清除資料</button>
      </div>
      <div class="result-box" id="faceResult">請點選上方按鈕抽選</div>
      <div class="stats-box">
        抽卡數：<span id="faceCount">0</span>
        金額：<span id="faceCost">0</span> 元<br>
        主1：<span id="faceMain1">0</span> (<span id="facePct1">0.00%</span>)<br>
        主2：<span id="faceMain2">0</span> (<span id="facePct2">0.00%</span>)<br>
        主3：<span id="faceMain3">0</span> (<span id="facePct3">0.00%</span>)<br>
        主4：<span id="faceMain4">0</span> (<span id="facePct4">0.00%</span>)
      </div>
      <div class="history-box" id="faceHistoryMale" style="display: block;"></div>
<div class="history-box" id="faceHistoryFemale" style="display: none;"></div>
</div>
    </div>
  </div>
<div id="targetTab" class="tab-content">
  <div class="button-group">
    <button onclick="switchTargetSubTab('hair')" id="targetHairTab" class="active">🎯 目標髮型</button>
    <button onclick="switchTargetSubTab('face')" id="targetFaceTab">🎯 目標臉型</button>
  </div>
  
<!-- ✅ 目標髮型 -->
<div id="targetHairContent" class="tab-content active">
  <div style="margin-top: 10px;">
    <label for="targetHairSelect">選擇目標髮型：</label>
    <select id="targetHairSelect"></select>
  </div>

 <div class="draw-reset-wrap" style="margin-top: 15px;">
  <button class="draw-button" onclick="startAutoDraw('hair')">開始抽卡</button>
  <button class="draw-button" onclick="stopAutoDraw()">停止</button>
  <button class="draw-button" onclick="clearTargetData('hair')">清除資料</button>
</div>

  <div class="result-box" id="targetHairResultMale" style="display: block;">請點選上方按鈕抽選</div>
  <div class="result-box" id="targetHairResultFemale" style="display: none;">請點選上方按鈕抽選</div>

  <div class="stats-box">
    抽卡數：<span id="targetHairCount">0</span><!-- 在 targetHairContent 區域的 stats-box 加入 -->
金額：<span id="targetHairCost">0</span> 元<br>
    主1：<span id="targetHairMain1">0</span> (<span id="targetHairPct1">0.00%</span>)<br>
    主2：<span id="targetHairMain2">0</span> (<span id="targetHairPct2">0.00%</span>)<br>
    主3：<span id="targetHairMain3">0</span> (<span id="targetHairPct3">0.00%</span>)<br>
    主4：<span id="targetHairMain4">0</span> (<span id="targetHairPct4">0.00%</span>)
  </div>

  <div class="history-box" id="targetHairHistoryMale" style="display: block;"></div>
  <div class="history-box" id="targetHairHistoryFemale" style="display: none;"></div>
</div>

<!-- ✅ 目標臉型 -->
<div id="targetFaceContent" class="tab-content">
  <div style="margin-top: 10px;">
    <label for="targetFaceSelect">選擇目標臉型：</label>
    <select id="targetFaceSelect"></select>
  </div>

  <div class="draw-reset-wrap" style="margin-top: 15px;">
  <button class="draw-button" onclick="startAutoDraw('face')">開始抽卡</button>
  <button class="draw-button" onclick="stopAutoDraw()">停止</button>
  <button class="draw-button" onclick="clearTargetData('face')">清除資料</button>
</div>

  <div class="result-box" id="targetFaceResultMale" style="display: block;">請點選上方按鈕抽選</div>
  <div class="result-box" id="targetFaceResultFemale" style="display: none;">請點選上方按鈕抽選</div>

  <div class="stats-box">
    抽卡數：<span id="targetFaceCount">0</span><!-- 在 targetFaceContent 區域的 stats-box 加入 -->
金額：<span id="targetFaceCost">0</span> 元<br>
    主1：<span id="targetFaceMain1">0</span> (<span id="targetFacePct1">0.00%</span>)<br>
    主2：<span id="targetFaceMain2">0</span> (<span id="targetFacePct2">0.00%</span>)<br>
    主3：<span id="targetFaceMain3">0</span> (<span id="targetFacePct3">0.00%</span>)<br>
    主4：<span id="targetFaceMain4">0</span> (<span id="targetFacePct4">0.00%</span>)
  </div>

  <div class="history-box" id="targetFaceHistoryMale" style="display: block;"></div>
  <div class="history-box" id="targetFaceHistoryFemale" style="display: none;"></div>
</div>
</div>
<script src="ao3z83.js"></script>

<script>
let gender = 'male';
let normalCounts = {
  male: { hair: { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 },
          face: { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 } },
  female: { hair: { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 },
            face: { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 } }
};
let targetCounts = JSON.parse(JSON.stringify(normalCounts));

function updateHistoryVisibility() {
  ['hair', 'face'].forEach(type => {
    const tabActive = document.getElementById(type + 'Tab').classList.contains('active');
    if (!tabActive) return;
    const maleBox = document.getElementById(type + 'HistoryMale');
    const femaleBox = document.getElementById(type + 'HistoryFemale');
    maleBox.style.display = (gender === 'male') ? 'block' : 'none';
    femaleBox.style.display = (gender === 'female') ? 'block' : 'none';
  });
}
function updateTargetResultVisibility() {
  ['Hair', 'Face'].forEach(type => {
    const isActive = document.getElementById(`target${type}Content`).classList.contains('active');
    ['Male', 'Female'].forEach(g => {
      const box = document.getElementById(`target${type}Result${g}`);
      if (box) {
        box.style.display = (gender === g.toLowerCase() && isActive) ? 'block' : 'none';
      }
    });
  });
}
function updateTargetHistoryVisibility() {
  ['Hair', 'Face'].forEach(type => {
    const isActive = document.getElementById(`target${type}Content`).classList.contains('active');
    ['Male', 'Female'].forEach(g => {
      const box = document.getElementById(`target${type}History${g}`);
      if (box) {
        box.style.display = (gender === g.toLowerCase() && isActive) ? 'block' : 'none';
      }
    });
  });
}
function updateTargetStats() {
  ['hair', 'face'].forEach(type => {
    updateStats(type, true);
  });
}
function selectGender(g) {
  gender = g;
  document.getElementById('genderMale').classList.toggle('active', g === 'male');
  document.getElementById('genderFemale').classList.toggle('active', g === 'female');
  document.getElementById('hairResult').textContent = '請點選上方按鈕抽選';
  document.getElementById('faceResult').textContent = '請點選上方按鈕抽選';
  if (document.getElementById('hairTab').classList.contains('active')) updateStats('hair');
  else if (document.getElementById('faceTab').classList.contains('active')) updateStats('face');
  updateHistoryVisibility();
  updateTargetDropdowns();
  updateTargetResultVisibility();
  updateTargetStats();
  updateTargetHistoryVisibility();
}
function switchTab(tab) {
  document.getElementById('tabHair').classList.toggle('active', tab === 'hair');
  document.getElementById('tabFace').classList.toggle('active', tab === 'face');
  document.getElementById('hairTab').classList.toggle('active', tab === 'hair');
  document.getElementById('faceTab').classList.toggle('active', tab === 'face');
  document.getElementById(tab + 'Result').textContent = '請點選上方按鈕抽選';
  updateHistoryVisibility();
}
function switchMainTab(tab) {
  document.getElementById('mainTabSingle').classList.toggle('active', tab === 'single');
  document.getElementById('mainTabTarget').classList.toggle('active', tab === 'target');
  document.getElementById('singleTab').classList.toggle('active', tab === 'single');
  document.getElementById('targetTab').classList.toggle('active', tab === 'target');
}
function switchTargetSubTab(subtab) {
  document.getElementById('targetHairTab').classList.toggle('active', subtab === 'hair');
  document.getElementById('targetFaceTab').classList.toggle('active', subtab === 'face');
  document.getElementById('targetHairContent').classList.toggle('active', subtab === 'hair');
  document.getElementById('targetFaceContent').classList.toggle('active', subtab === 'face');
  updateTargetResultVisibility();
  updateTargetStats();
  updateTargetHistoryVisibility();
}
function updateTargetDropdowns() {
  const hairSelect = document.getElementById('targetHairSelect');
  const faceSelect = document.getElementById('targetFaceSelect');
  hairSelect.innerHTML = '';
  faceSelect.innerHTML = '';
  hairItems.filter(i => i.gender === gender).forEach(item => {
    const opt = document.createElement('option');
    opt.value = item.name;
    opt.textContent = `[${item.type}] ${item.name}`;
    hairSelect.appendChild(opt);
  });
  surgeryItems.filter(i => i.gender === gender).forEach(item => {
    const opt = document.createElement('option');
    opt.value = item.name;
    opt.textContent = `[${item.type}] ${item.name}`;
    faceSelect.appendChild(opt);
  });
}
function updateStats(type, isTarget = false) {
  const data = isTarget ? targetCounts[gender][type] : normalCounts[gender][type];
  const total = data.total;
  const prefix = isTarget ? `target${capitalize(type)}` : type;
  
  for (let i = 1; i <= 4; i++) {
    document.getElementById(`${prefix}Main${i}`).textContent = data['main' + i];
    const pct = total ? ((data['main' + i] / total) * 100).toFixed(2) : '0.00';
    document.getElementById(`${prefix}Pct${i}`).textContent = pct + '%';
  }
  document.getElementById(`${prefix}Count`).textContent = total;
  
  // ✅ 新增金額邏輯
  const discount = Math.floor(total / 10) * 60;
  const cost = total * 60 - discount;
  const costElem = document.getElementById(`${prefix}Cost`);
  if (costElem) {
    costElem.textContent = cost.toLocaleString();
  }
}
function capitalize(s) {
  return s.charAt(0).toUpperCase() + s.slice(1);
}
function updateHistory(type, html) {
  const boxId = type + 'History' + (gender === 'male' ? 'Male' : 'Female');
  const box = document.getElementById(boxId);
  const entry = document.createElement('div');
  const number = normalCounts[gender][type].total;
  entry.innerHTML = `${number}. ${html}`;
  box.prepend(entry);
  if (box.children.length > 200) box.removeChild(box.lastChild);
}
function updateTargetHistory(type, html) {
  const boxId = `target${capitalize(type)}History${gender === 'male' ? 'Male' : 'Female'}`;
  const box = document.getElementById(boxId);
  const number = targetCounts[gender][type].total;
  const entry = document.createElement('div');
  entry.innerHTML = `${number}. ${html}`;
  box.prepend(entry);
  if (box.children.length > 200) box.removeChild(box.lastChild);
}
function clearData(type) {
  normalCounts[gender][type] = { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 };
  const costElem = document.getElementById(`${type}Cost`);
if (costElem) {
  costElem.textContent = '0';
}
  updateStats(type);
  document.getElementById(`${type}Result`).textContent = '請點選上方按鈕抽選';
  const boxId = `${type}History${gender === 'male' ? 'Male' : 'Female'}`;
  document.getElementById(boxId).innerHTML = '';
}
function draw(type) {
  const pool = (type === 'hair') ? hairItems : surgeryItems;
  const filtered = pool.filter(item => item.gender === gender);
  const totalChance = filtered.reduce((sum, item) => sum + item.chance, 0);
  const roll = Math.random() * totalChance;
  let cumulative = 0, result = null;
  for (let item of filtered) {
    cumulative += item.chance;
    if (roll <= cumulative) { result = item; break; }
  }
  let mainIndex = ['SSS','SS','S','A'].indexOf(result.type) + 1;
  normalCounts[gender][type].total++;
  if (mainIndex > 0) normalCounts[gender][type]['main' + mainIndex]++;
  const rarityClass = result.type.toLowerCase() + '-bg';
  document.getElementById(type + 'Result').innerHTML = `你抽中了：<span class="${rarityClass}">${result.name}</span>`;
  updateStats(type);
  updateHistory(type, `<span class="${rarityClass}">${result.name}</span>`);
  updateHistoryVisibility();
}
let autoDrawInterval = null;
function startAutoDraw(type) {
  const select = document.getElementById(type === 'hair' ? 'targetHairSelect' : 'targetFaceSelect');
  const targetName = select.value;
  if (!targetName) return alert('請先選擇目標項目！');
  if (autoDrawInterval) return alert('已經在自動抽卡中！請先停止。');
  autoDrawInterval = setInterval(() => {
    const pool = (type === 'hair') ? hairItems : surgeryItems;
    const filtered = pool.filter(item => item.gender === gender);
    const totalChance = filtered.reduce((sum, item) => sum + item.chance, 0);
    const roll = Math.random() * totalChance;
    let cumulative = 0, result = null;
    for (let item of filtered) {
      cumulative += item.chance;
      if (roll <= cumulative) { result = item; break; }
    }
    let mainIndex = ['SSS','SS','S','A'].indexOf(result.type) + 1;
    targetCounts[gender][type].total++;
    if (mainIndex > 0) targetCounts[gender][type]['main' + mainIndex]++;
    const rarityClass = result.type.toLowerCase() + '-bg';
    const boxId = `target${capitalize(type)}Result${gender === 'male' ? 'Male' : 'Female'}`;
    document.getElementById(boxId).innerHTML = `你抽中了：<span class="${rarityClass}">${result.name}</span>`;
    updateStats(type, true);
    updateTargetHistory(type, `<span class="${rarityClass}">${result.name}</span>`);
    updateTargetHistoryVisibility();
    if (result.name === targetName) {
      clearInterval(autoDrawInterval);
      autoDrawInterval = null;
      alert(`🎯 抽中目標【${targetName}】囉！`);
    }
  }, 100);
}
function stopAutoDraw() {
  if (autoDrawInterval !== null) {
    clearInterval(autoDrawInterval);
    autoDrawInterval = null;
    alert('⏹️ 已停止自動抽卡。');
  }
}
function clearTargetData(type) {
  targetCounts[gender][type] = { total: 0, main1: 0, main2: 0, main3: 0, main4: 0 };
  updateStats(type, true);
  const costElem = document.getElementById(`target${capitalize(type)}Cost`);
if (costElem) {
  costElem.textContent = '0';
}

  const resultBoxId = (type === 'hair')
    ? `targetHairResult${gender === 'male' ? 'Male' : 'Female'}`
    : `targetFaceResult${gender === 'male' ? 'Male' : 'Female'}`;
  document.getElementById(resultBoxId).textContent = '請點選上方按鈕抽選';

  const historyBoxId = (type === 'hair')
    ? `targetHairHistory${gender === 'male' ? 'Male' : 'Female'}`
    : `targetFaceHistory${gender === 'male' ? 'Male' : 'Female'}`;
  document.getElementById(historyBoxId).innerHTML = '';
}
// 初始化狀態
updateHistoryVisibility();
updateTargetResultVisibility();
updateTargetHistoryVisibility();
updateTargetStats();
</script>
fetch("https://api.countapi.xyz/hit/anzu-simulator/total")
  .then(res => res.json())
  .then(data => {
    document.getElementById("visitNum").textContent = data.value.toLocaleString();
  });