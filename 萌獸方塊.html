
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>èŒç¸æ–¹å¡Šæ¨¡æ“¬å™¨</title>
  <style>
.container {
  max-width: 400px;
  width: 90%;
  margin: auto;
}
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: #ffeceb;
      margin: 0;
      padding: 2em;
      display: flex;
      justify-content: center;
    }
    .cube-box {
      background: #fbb9a7;
      padding: 2em;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 600px;
    }
    .title {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 1.2em;
    }
    .btn-row {
      display: flex;
      justify-content: center;
      gap: 1em;
      margin-bottom: 1em;
    }
    .btn {
      padding: 0.8em 2em;
      font-size: 1.1rem;
      background-color: #f15a29;
      color: white;
      border: none;
      border-radius: 8px;
      box-shadow: 0 4px 0 #b53c1c;
      cursor: pointer;
    }
    .setting-btn {
      font-size: 0.9rem;
      padding: 0.5em 1em;
      background-color: #888;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .dropdown-select {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5em;
      margin-bottom: 1.5em;
    }
    select {
      padding: 0.5em;
      font-size: 1rem;
      width: 70%;
    }
    .result-area {
      background: #ffeceb;
      min-height: 120px;
      border-radius: 12px;
      padding: 1em;
      font-size: 1.1rem;
      color: #333;
      margin-bottom: 1em;
    }
    .control-row {
      display: flex;
      justify-content: center;
      gap: 1em;
      margin-bottom: 1.5em;
    }
    .stats-section {
      background: #fff6f5;
      padding: 1em;
      border-radius: 12px;
      margin-top: 1em;
    }
    .stats-list {
      margin-top: 0.5em;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
    }
    .stat-line {
      margin-bottom: 0.3em;
    }
    .stat-group {
      margin-bottom: 0.8em;
    }
    .stat-group-title {
      font-weight: bold;
      margin-top: 0.5em;
      margin-bottom: 0.2em;
    }
  </style>
  <script src="potential_table_lv5.js"></script>
</head>
<body>

  <div class="cube-box">
    <div class="title">èŒç¸æ–¹å¡Š</div>

    <div class="dropdown-select">
      <select id="target1"><option>è«‹é¸æ“‡ç›®æ¨™è©æ¢ 1</option></select>
      <select id="target2"><option>è«‹é¸æ“‡ç›®æ¨™è©æ¢ 2</option></select>
      <select id="target3"><option>è«‹é¸æ“‡ç›®æ¨™è©æ¢ 3</option></select>
    </div>

    <div class="btn-row">
      <button class="btn" onclick="drawOnce()">æ´—ä¸€æ¬¡</button>
      <button class="setting-btn" onclick="drawUntilTarget()">æ´—åˆ°æŒ‡å®šç›®æ¨™</button>
    </div>

    <div class="result-area" id="resultArea">
      å°šæœªé–‹å§‹æ´—æ–¹å¡Š...
    </div>

    <div class="control-row">
      <button class="btn" onclick="clearStats()">æ¸…é™¤çµ±è¨ˆ</button>
      <button class="btn" onclick="forceStop()">å¼·åˆ¶åœæ­¢</button>
    </div>

    <div class="stats-section">
      é¡¯ç¤ºçµ±è¨ˆçµæœï¼š
      <div class="stats-list" id="statsList">
        <div class="stat-line" id="totalDraws"><strong>ç¸½å…±æ´—æ–¹å¡Šæ¬¡æ•¸ï¼š</strong>0 æ¬¡</div>
        <div class="stat-group">
          <div class="stat-group-title">ğŸ¯ ç‰¹æ®Šæ¢ä»¶å‘½ä¸­çµ±è¨ˆ</div>
          <div class="stat-line">å–®çµ‚ï¼š<span id="count_single_final">0</span> æ¬¡</div>
          <div class="stat-line">é›™çµ‚ï¼š<span id="count_double_final">0</span> æ¬¡</div>
          <div class="stat-line">é›™çµ‚ç‰©ï¼š<span id="count_double_final_physical">0</span> æ¬¡</div>
          <div class="stat-line">é›™çµ‚é­”ï¼š<span id="count_double_final_magic">0</span> æ¬¡</div>
          <div class="stat-line">ä¸‰çµ‚ï¼š<span id="count_triple_final">0</span> æ¬¡</div>
          <div class="stat-line">ä¸‰ç‰©ï¼š<span id="count_triple_physical">0</span> æ¬¡</div>
          <div class="stat-line">ä¸‰é­”ï¼š<span id="count_triple_magic">0</span> æ¬¡</div>
          <div class="stat-line">ä¸‰åŠ æŒï¼š<span id="count_triple_buff">0</span> æ¬¡</div>
        </div>
      </div>
    </div>

  </div>

<script>
let isAutoDrawing = false;
let isDrawing = false;
  let totalDrawCount = 0;
let lastDrawnOptions = [];

let count_single_final = 0;
let count_double_final = 0;
let count_double_final_physical = 0;
let count_double_final_magic = 0;
let count_triple_final = 0;
let count_triple_physical = 0;
let count_triple_magic = 0;
let count_triple_buff = 0;


  function populateDropdowns() {
    const dropdowns = [document.getElementById('target1'), document.getElementById('target2'), document.getElementById('target3')];
    dropdowns.forEach(select => {
      potentialList.forEach(p => {
        const option = document.createElement('option');
        option.value = p.name;
        option.textContent = p.name;
        select.appendChild(option);
      });
    });
  }

  function weightedRandomDraw() {
    const total = potentialList.reduce((sum, p) => sum + p.chance, 0);
    let r = Math.random() * total;
    for (let p of potentialList) {
      if (r < p.chance) return p;
      r -= p.chance;
    }
    return potentialList[potentialList.length - 1];
  }

  
function calculateDiscountedCost(drawCount) {
  const fullBlocks = Math.floor(drawCount / 10);
  const remaining = drawCount % 10;
  return fullBlocks * 270 + remaining * 30;
}

function drawOnce() {
    const result = [];
    lastDrawnOptions = result;
    for (let i = 0; i < 3; i++) {
      const draw = weightedRandomDraw();
      result.push(draw);
    }

    totalDrawCount++;

  const names = result.map(r => r.name);
  const finalCount = names.filter(name => name === "æœ€çµ‚å‚·å®³").length;
  const physicalCount = names.filter(name => name === "ç‰©ç†æ”»æ“ŠåŠ›%").length;
  const magicCount = names.filter(name => name === "é­”æ³•æ”»æ“ŠåŠ›%").length;
  const buffCount = names.filter(name => name.includes("åŠ æŒæŠ€èƒ½æŒçºŒæ™‚é–“")).length;

  if (finalCount === 3) {
    count_triple_final++;
  } else if (finalCount === 2 && physicalCount === 1) {
    count_double_final_physical++;
  } else if (finalCount === 2 && magicCount === 1) {
    count_double_final_magic++;
  } else if (finalCount === 2) {
    count_double_final++;
  } else if (finalCount === 1) {
    count_single_final++;
  }

  if (physicalCount === 3) count_triple_physical++;
  if (magicCount === 3) count_triple_magic++;
  if (buffCount === 3) count_triple_buff++;

  document.getElementById("count_single_final").innerText = count_single_final;
  document.getElementById("count_double_final").innerText = count_double_final;
  document.getElementById("count_double_final_physical").innerText = count_double_final_physical;
  document.getElementById("count_double_final_magic").innerText = count_double_final_magic;
  document.getElementById("count_triple_final").innerText = count_triple_final;
  document.getElementById("count_triple_physical").innerText = count_triple_physical;
  document.getElementById("count_triple_magic").innerText = count_triple_magic;
  document.getElementById("count_triple_buff").innerText = count_triple_buff;

    document.getElementById('totalDraws').innerHTML = `<strong>ç¸½å…±æ´—æ–¹å¡Šæ¬¡æ•¸ï¼š</strong>${totalDrawCount} æ¬¡ ï¼ˆğŸ’°ç¸½é‡‘é¡ï¼š${calculateDiscountedCost(totalDrawCount)} å…ƒï¼‰`;

    const resultDiv = document.getElementById('resultArea');
    resultDiv.innerHTML = 


result.map(r => {
  if (typeof r.value === "string" && r.value.includes("/") && r.name.includes("ä¸€å®šæ©Ÿç‡") && r.name.includes("æ•ˆæœ")) {
    const [chance, level] = r.value.split("/");
    return r.name.replace("ä¸€å®šæ©Ÿç‡", `${chance.trim()}% æ©Ÿç‡`).replace("æ•ˆæœ", `${level.trim()}ç´šæ•ˆæœ`);
  }
  if (typeof r.value === "string" && r.value.includes("/") && r.name.includes("æ¢å¾©") && r.name.includes("æ©Ÿç‡")) {
    const [chance, amount] = r.value.split("/");
    const type = r.name.includes("HP") ? "HP" : "MP";
    return `æ”»æ“Šæ™‚æœ‰${chance.trim()}%æ©Ÿç‡æ¢å¾©${amount.trim()}${type}`;
  }
  if (r.name.includes("ä¸€å®šçš„å±¬æ€§ä¾†è¿½åŠ èŒç¸æ”»æ“ŠåŠ›")) {
    return r.name.replace("ä¸€å®šçš„", `${r.value}%`);
  }
  if (r.name.includes("ä¸€å®šçš„æ”»æ“ŠåŠ›ä¾†è¿½åŠ èŒç¸æ”»æ“ŠåŠ›")) {
    return r.name.replace("ä¸€å®šçš„", `${r.value}%`);
  }
  if (r.name === "åŠ æŒæŠ€èƒ½æŒçºŒæ™‚é–“") {
  return `${r.name} +${r.value}%`;
}
  if (r.name.includes("ä¸€å®šç§’æ•¸å…§æ¢å¾©HP")) {
    return `ä¸€å®šç§’æ•¸å…§æ¢å¾©${r.value}HP`;
  }
  if (r.name.includes("ä¸€å®šç§’æ•¸å…§æ¢å¾©MP")) {
    return `ä¸€å®šç§’æ•¸å…§æ¢å¾©${r.value}MP`;
  }
  if (r.name === "çˆ†æ“Šæ©Ÿç‡") {
    return `${r.name}+${r.value}%`;
  }
  if (r.name === "æœ€çµ‚å‚·å®³") {
    return `${r.name}+${r.value}%`;
  }
  if (r.name.endsWith('%')) {
    return `${r.name.slice(0, -1)} +${r.value}%`;
  }
  return `${r.name} +${r.value}`;
}).join('<br>');



  

function updateStatWithPercentage(id, count) {
      const percent = totalDrawCount > 0 ? ((count / totalDrawCount) * 100).toFixed(6) : "0.000000";
      document.getElementById(id).innerText = `${count}ï¼ˆ${percent}%ï¼‰`;
    }

    updateStatWithPercentage("count_single_final", count_single_final);
    updateStatWithPercentage("count_double_final", count_double_final);
    updateStatWithPercentage("count_double_final_physical", count_double_final_physical);
    updateStatWithPercentage("count_double_final_magic", count_double_final_magic);
    updateStatWithPercentage("count_triple_final", count_triple_final);
    updateStatWithPercentage("count_triple_physical", count_triple_physical);
    updateStatWithPercentage("count_triple_magic", count_triple_magic);
    updateStatWithPercentage("count_triple_buff", count_triple_buff);
}
function drawUntilTarget() {
  if (isDrawing) {
    alert("æŠ½å¡é€²è¡Œä¸­ï¼Œè«‹å…ˆåœæ­¢æˆ–ç­‰å¾…å®Œæˆï¼");
    return;
  }
  
  const targets = [
    document.getElementById("target1").value,
    document.getElementById("target2").value,
    document.getElementById("target3").value
  ].filter(v => v && !v.includes("è«‹é¸æ“‡"));
  
  if (targets.length === 0) {
    alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç›®æ¨™è©æ¢ï¼");
    return;
  }
  
  isAutoDrawing = true;
  isDrawing = true;
  
  function matchTarget(names, targets) {
    const nameCount = {};
    names.forEach(n => nameCount[n] = (nameCount[n] || 0) + 1);
    for (let t of targets) {
      if (!nameCount[t]) return false;
      nameCount[t]--;
    }
    return true;
  }
  
  function loopDraw() {
    if (!isAutoDrawing) {
      isDrawing = false;
      return;
    }
    
    drawOnce();
    const drawnNames = lastDrawnOptions.map(r => r.name);
    if (matchTarget(drawnNames, targets)) {
      isAutoDrawing = false;
      isDrawing = false;
      alert("ğŸ¯ é”æˆç›®æ¨™æ¢ä»¶ï¼");
      return;
    }
    
    setTimeout(loopDraw, 0); // æ¯ 200ms æ´—ä¸€æ¬¡
  }
  
  loopDraw();
}

  function clearStats() {
    totalDrawCount = 0;
    document.getElementById('totalDraws').innerHTML = `<strong>ç¸½å…±æ´—æ–¹å¡Šæ¬¡æ•¸ï¼š</strong>0 æ¬¡ ï¼ˆğŸ’°ç¸½é‡‘é¡ï¼š0 å…ƒï¼‰`;
    
    count_single_final = 0;
    count_double_final = 0;
    count_double_final_physical = 0;
    count_double_final_magic = 0;
    count_triple_final = 0;
    count_triple_physical = 0;
    count_triple_magic = 0;
    count_triple_buff = 0;

    document.getElementById("count_single_final").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_double_final").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_double_final_physical").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_double_final_magic").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_triple_final").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_triple_physical").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_triple_magic").innerText = "0ï¼ˆ0.000000%ï¼‰";
    document.getElementById("count_triple_buff").innerText = "0ï¼ˆ0.000000%ï¼‰";
document.getElementById('resultArea').innerHTML = 'å°šæœªé–‹å§‹æ´—æ–¹å¡Š...';
  }

  function forceStop() {
    isAutoDrawing = false;
    alert('â›” å·²åœæ­¢è‡ªå‹•æ´—æ–¹å¡Šï¼');
  }

  window.onload = populateDropdowns;
</script>





<script>
<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbzyNq-_CcGmVJkHd5CHBcWz9naWzACPnKbHCTGEhsl5VBJiPUw1BGHlyyZ6mJmI7RTD4w/exec";
const pageName = "èŒç¸æ–¹å¡Š"; // â† ä¿®æ”¹ç‚ºè©²åˆ†é åç¨±ï¼

fetch(${apiUrl}?page=${encodeURIComponent(pageName)})
  .then(() => {
    // æˆåŠŸé€å‡ºï¼Œä¸éœ€é¡¯ç¤ºå…§å®¹
  })
  .catch(err => {
    console.error("è¨ªå•è¨˜éŒ„å¤±æ•—ï¼š", err);
  });
</script>
</script>
</body>
</html>