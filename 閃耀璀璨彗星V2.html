
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>楓之谷 時裝抽選模擬</title>
  <script src="device_control.js"></script>

  <style>
   body {
  font-family: Arial, sans-serif;
  background-image: url('https://i.ibb.co/j9MgZqPj/Yo-Ohshima-Sheep-R3.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: center;
  padding: 20px;
  text-align: center;
}

    .container {
      max-width: 700px;
      width: 100%;
      padding: 0 1em;
      margin: 0 auto;
      box-sizing: border-box;
    }

    /* 🔧 修正後的按鈕群組樣式（支援手機） */
    .button-group {
      display: flex;
      flex-wrap: nowrap;
      justify-content: space-between;
      gap: 8px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-bottom: 10px;
    }

    .button-group button {
      flex: 1 1 auto;
      padding: 10px 12px;
      font-size: 1em;
      min-width: 100px;
      border: none;
      border-radius: 10px;
      background-color: #e0e0ff;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .button-group button.active,
    .button-group button:hover {
      background-color: #a89aff;
      transform: scale(1.05);
    }

    .tab-content {
      display: none;
      margin-top: 20px;
    }

    .tab-content.active {
      display: block;
    }

    .draw-button {
      font-size: 1.1em;
      padding: 10px 20px;
      margin: 5px;
      background: linear-gradient(to right, #80d0c7, #13547a);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .draw-button:hover {
      background: linear-gradient(to right, #13547a, #80d0c7);
      transform: translateY(-2px);
    }



#backButton {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 999;
  background: rgba(255, 255, 255, 0.85);
  color: #333;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.95em;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  transition: all 0.2s ease;
}

#backButton:hover {
  background: #e0e0e0;
}
    .result-box,
    .stats-box,
    .history-box {
      margin-top: 10px;
      background: #ffffff;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }

    .history-box {
      max-height: 200px;
      overflow-y: auto;
    }

    span.s { color: gold; font-weight: bold; }
    span.a { color: #66cc66; font-weight: bold; }
    span.b { color: #3399ff; }
    span.c { color: #999; }

    @media (max-width: 480px) {
      .draw-button {
        width: 45%;
        font-size: 0.95em;
        padding: 10px 12px;
      }

      .result-box,
      .stats-box,
      .history-box {
        font-size: 0.95em;
      }
    }
  </style>
</head>
<body><button onclick="history.back()" id="backButton">← 返回</button>
  <div class="container">
    <h1>楓之谷 時裝抽選模擬</h1>

    <div class="button-group">
      <button onclick="selectGender('male')" id="genderMale" class="active"> 男</button>
      <button onclick="selectGender('female')" id="genderFemale"> 女</button>
    </div>

    <div class="button-group">
  <button onclick="switchTab('sparkling')" id="tabSparkling" class="active">閃亮彗星</button>

  <button onclick="switchTab('brilliant')" id="tabBrilliant"> 璀璨星光</button>
    <button onclick="switchTab('sparklingTarget')" id="tabSparklingTarget"> 閃亮彗星指定</button>
</div>

<!-- 閃亮彗星頁面 -->
<div id="sparklingTab" class="tab-content active">
  <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: nowrap; flex-shrink: 0; margin-bottom: 10px;">
    <button class="draw-button" onclick="draw('sparkling', false)" style="flex: 1 1 0; min-width: 80px;">抽選</button>
    <button class="draw-button" onclick="draw('sparkling', true)" style="flex: 1 1 0; min-width: 80px;">10連抽</button>
    <button class="draw-button" onclick="clearData('sparkling')" style="flex: 1 1 0; min-width: 80px;">清除</button>
  </div>
  <div class="result-box" id="sparklingResult">請點選上方按鈕抽選</div>
  <div class="stats-box">
  抽卡數：<span id="sparklingCount">0</span><br>
  總花費：<span id="sparklingSpent">0</span> 元<br> <!-- ✅ 新增 -->
  <div id="sparklingRarityStats"></div>
</div>
  <div class="history-box" id="sparklingHistory"></div>
</div>

<!-- 璀璨星光頁面 -->
<div id="brilliantTab" class="tab-content">
  <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: nowrap; flex-shrink: 0; margin-bottom: 10px;">
    <button class="draw-button" onclick="draw('brilliant', false)" style="flex: 1 1 0; min-width: 80px;">抽選</button>
    <button class="draw-button" onclick="draw('brilliant', true)" style="flex: 1 1 0; min-width: 80px;">10連抽</button>
    <button class="draw-button" onclick="clearData('brilliant')" style="flex: 1 1 0; min-width: 80px;">重置</button>
  </div>
  <div class="result-box" id="brilliantResult">請點選上方按鈕抽選</div>
  <div class="stats-box">
    抽卡數：<span id="brilliantCount">0</span><br>
    <div id="brilliantRarityStats"></div>
  </div>
  <div class="history-box" id="brilliantHistory"></div>
</div>
  </div>
<!-- 🎯 閃亮彗星指定頁面 -->
<!-- 🎯 閃亮彗星指定頁面 -->
<div id="sparklingTargetTab" class="tab-content">
  <div style="margin: 10px 0;">
    <label for="raritySelect">選擇等級：</label>
    <select id="raritySelect" onchange="updateTargetDropdowns()"></select>
  </div>
  <div style="margin: 10px 0;">
    <label for="targetSelect">選擇目標道具：</label>
    <select id="targetSelect"></select>
  </div>

<div style="display: flex; gap: 10px; justify-content: center; flex-wrap: nowrap; flex-shrink: 0; margin: 10px 0;">
  <button class="draw-button" onclick="startTargetDraw()" style="flex: 1 1 0; min-width: 80px;">開始</button>
  <button class="draw-button" onclick="stopTargetDraw()" style="flex: 1 1 0; min-width: 80px;">停止</button>
  <button class="draw-button" onclick="clearTargetData()" style="flex: 1 1 0; min-width: 80px;">清除</button>
</div>

<div class="result-box" id="sparklingTargetResult">請選擇目標並點擊開始</div>
<div class="stats-box">
  抽卡數：<span id="sparklingTargetCount">0</span><br>
總花費：<span id="sparklingTargetSpent">0</span> 元<br> <!-- ✅ 新增 -->
  指定目標機率：<span id="targetChance">-</span><br>
  <div id="sparklingTargetRarityStats"></div>
</div>
<div class="history-box" id="sparklingTargetHistory"></div>
</div>
  <script src="fashion.js"></script>
  <script>
    let gender = 'male';
    let counts = {
      sparkling: { total: 0, S: 0, A: 0, B: 0, C: 0 },
      brilliant: { total: 0, S: 0, A: 0, B: 0, C: 0 }
    };
 let moneySpent = {
  sparkling: 0,
  sparklingTarget: 0
};
    function selectGender(g) {
  gender = g;
  document.getElementById('genderMale').classList.toggle('active', g === 'male');
  document.getElementById('genderFemale').classList.toggle('active', g === 'female');
  
  // 🔁 如果在「閃亮彗星指定」頁面，也要即時更新選單
  if (document.getElementById('sparklingTargetTab').classList.contains('active')) {
    updateTargetDropdowns();
  }
}

    function switchTab(tab) {
  ['sparkling', 'sparklingTarget', 'brilliant'].forEach(t => {
    const button = document.getElementById(`tab${capitalize(t)}`);
    const content = document.getElementById(`${t}Tab`);
    if (button && content) {
      button.classList.toggle('active', t === tab);
      content.classList.toggle('active', t === tab);
    }
  });
}

    function draw(type, isTenDraw) {
      const pool = (type === 'sparkling') ? sparklingItems : brilliantItems;
      const filtered = pool.filter(item => !item.gender || item.gender === gender);

      let results = [];
      for (let n = 0; n < (isTenDraw ? 10 : 1); n++) {
        const totalChance = filtered.reduce((sum, item) => sum + item.chance, 0);
        const roll = Math.random() * totalChance;
        let cumulative = 0, result = null;
        for (let item of filtered) {
          cumulative += item.chance;
          if (roll <= cumulative) {
            result = item;
            break;
          }
        }
        if (result) {
  if (result) {
  results.push(result);
  counts[type].total++;

  // 加入金額：每抽 50 元，滿 10 折 50
  moneySpent[type] += 50;
  if (counts[type].total % 10 === 0) {
    moneySpent[type] -= 50;
  }
}
  

          
          
          
          
          if (['S', 'A', 'B', 'C'].includes(result.type)) {
            counts[type][result.type]++;
          }
        }
      }

      const resultHTML = results.map(item => {
  const rarityClass = item.type.toLowerCase();
  const style = item.type === 'A' ? ' style="background-color: red; color: white; border-radius: 5px; padding: 2px 5px;"' : '';
  return `<span class="${rarityClass}"${style}>${item.name}</span>`;
}).join('、');
      document.getElementById(`${type}Result`).innerHTML = '你抽中了：' + resultHTML;

      updateStats(type);
      results.forEach(item => {
  const rarity = item.type;
  const className = rarity.toLowerCase();
  const specialStyle = (rarity === 'A')
    ? ' style="background-color: red; color: white; border-radius: 5px; padding: 2px 6px;"'
    : '';
  const span = `<span class="${className}"${specialStyle}>${item.name}</span>`;
  updateHistory(type, span);
});
    }

    function updateStats(type) {
      const statsDiv = document.getElementById(`${type}RarityStats`);
      const total = counts[type].total;
      let html = '';
      ['S', 'A', 'B', 'C'].forEach(r => {
        if (counts[type][r] > 0) {
          const pct = ((counts[type][r] / total) * 100).toFixed(2);
          html += `<span class="${r.toLowerCase()}">${r}</span>：${counts[type][r]} (${pct}%)<br>`;
        }
      });
      document.getElementById(`${type}Count`).textContent = total;
if (document.getElementById(`${type}Spent`)) {
  document.getElementById(`${type}Spent`).textContent = moneySpent[type];
}
statsDiv.innerHTML = html;
    }

    function updateHistory(type, html) {
      const box = document.getElementById(`${type}History`);
      const entry = document.createElement('div');
      entry.innerHTML = `${counts[type].total}. ${html}`;
      box.prepend(entry);
      if (box.children.length > 100) box.removeChild(box.lastChild);
    }

    function clearData(type) {
      counts[type] = { total: 0, S: 0, A: 0, B: 0, C: 0 };
      document.getElementById(`${type}Result`).textContent = '請點選上方按鈕抽選';
      document.getElementById(`${type}History`).innerHTML = '';
      moneySpent[type] = 0;
updateStats(type);
    }
function initRarityOptions() {
  const raritySet = new Set();
  sparklingItems.forEach(item => {
    if (item.type) raritySet.add(item.type);
  });

  const raritySelect = document.getElementById("raritySelect");
  raritySelect.innerHTML = "";

  [...raritySet].sort().forEach(r => {
    const option = document.createElement("option");
    option.value = r;
    option.textContent = r + " 級";
    raritySelect.appendChild(option);
  });

  updateTargetDropdowns(); // 預設載入一次
}

function updateTargetDropdowns() {
  const rarity = document.getElementById("raritySelect").value;
  const filtered = sparklingItems.filter(item =>
    (!item.gender || item.gender === gender) && item.type === rarity
  );
  
  const select = document.getElementById("targetSelect");
  select.innerHTML = "";
  filtered.forEach(item => {
    const opt = document.createElement("option");
    opt.value = item.name;
    opt.textContent = item.name;
    select.appendChild(opt);
  });
}
    function capitalize(s) {
      return s.charAt(0).toUpperCase() + s.slice(1);
    }
    window.onload = () => {
  initRarityOptions();
};

// ✅ 新增 target 模式的抽卡紀錄
counts["sparklingTarget"] = { total: 0, S: 0, A: 0, B: 0, C: 0, hits: 0 };

let targetDrawInterval = null;

function startTargetDraw() {
  
  
  const target = document.getElementById("targetSelect").value;
  if (!target) return alert("請先選擇目標道具！");
  if (targetDrawInterval) return;

  targetDrawInterval = setInterval(() => {
    const filtered = sparklingItems.filter(
      item => (!item.gender || item.gender === gender)
    );
    const totalChance = filtered.reduce((sum, item) => sum + item.chance, 0);
    const roll = Math.random() * totalChance;

    let cumulative = 0, result = null;
    for (let item of filtered) {
      cumulative += item.chance;
      if (roll <= cumulative) {
        result = item;
        break;
      }
    }

    if (result) {
      counts["sparklingTarget"].total++;
moneySpent["sparklingTarget"] += 50;
if (counts["sparklingTarget"].total % 10 === 0) {
  moneySpent["sparklingTarget"] -= 50;
}
      if (['S', 'A', 'B', 'C'].includes(result.type)) {
        counts["sparklingTarget"][result.type]++;
      }

      const rarity = result.type;
      const className = rarity.toLowerCase();
      const styled = (rarity === 'A') ?
        ' style="background-color: red; color: white; border-radius: 5px; padding: 2px 6px;"' :
        '';
      const resultText = `<span class="${className}"${styled}>${result.name}</span>`;

      document.getElementById("sparklingTargetResult").innerHTML = `抽到：${resultText}`;
      document.getElementById("sparklingTargetCount").textContent = counts["sparklingTarget"].total;
document.getElementById("sparklingTargetSpent").textContent = moneySpent["sparklingTarget"];
updateTargetStats();
      const historyBox = document.getElementById("sparklingTargetHistory");
      const entry = document.createElement("div");
      entry.innerHTML = `${counts["sparklingTarget"].total}. ${resultText}`;
      historyBox.prepend(entry);
      if (historyBox.children.length > 100) historyBox.removeChild(historyBox.lastChild);

      if (result.name === target) {
  counts["sparklingTarget"].hits++;
  const hitRate = ((counts["sparklingTarget"].hits / counts["sparklingTarget"].total) * 100).toFixed(2);
  document.getElementById("targetChance").textContent = `${hitRate}%`;

  clearInterval(targetDrawInterval);
  targetDrawInterval = null;
  alert("已抽到目標道具！");
}
    }
  }, 20);
}

function stopTargetDraw() {
  clearInterval(targetDrawInterval);
  targetDrawInterval = null;
}

function clearTargetData() {
  counts["sparklingTarget"] = { total: 0, S: 0, A: 0, B: 0, C: 0, hits: 0 };
moneySpent["sparklingTarget"] = 0;
  document.getElementById("sparklingTargetResult").textContent = "請選擇目標並點擊開始";
  document.getElementById("sparklingTargetCount").textContent = 0;
  document.getElementById("sparklingTargetSpent").textContent = 0;
  document.getElementById("sparklingTargetHistory").innerHTML = "";
  document.getElementById("sparklingTargetRarityStats").innerHTML = "";
  document.getElementById("targetChance").textContent = "-";
}
function updateTargetStats() {
  const statsDiv = document.getElementById("sparklingTargetRarityStats");
  const total = counts["sparklingTarget"].total;
  let html = '';
  ['S', 'A', 'B', 'C'].forEach(r => {
    if (counts["sparklingTarget"][r] > 0) {
      const pct = ((counts["sparklingTarget"][r] / total) * 100).toFixed(2);
      html += `<span class="${r.toLowerCase()}">${r}</span>：${counts["sparklingTarget"][r]} (${pct}%)<br>`;
    }
  });
  statsDiv.innerHTML = html;
}
function goBack() {
  // 如果有前一頁紀錄，就返回
  if (document.referrer) {
    window.history.back();
  } else {
    // 沒有紀錄就導向首頁或指定頁面
    window.location.href = "index.html"; // ← 你可以改成想要的預設頁面
  }
}
</script>
  </script>
</body>
</html>
